<!-- TOC -->

- [问题](#问题)
- [核心理念是通过缓存、异步、限流来保证系统的高并发和高可用](#核心理念是通过缓存异步限流来保证系统的高并发和高可用)
- [设计思路](#设计思路)
- [前端方案](#前端方案)
- [站点层面的请求拦截](#站点层面的请求拦截)
- [后端方案](#后端方案)
- [使用JMeter 压测工具](#使用jmeter-压测工具)

<!-- /TOC -->
# 问题
* 瞬时大并发
* 超卖
    * 加悲观锁
    * 使用消息队列
    * 加乐观锁
# 核心理念是通过缓存、异步、限流来保证系统的高并发和高可用

# 设计思路
* 将请求拦截在系统上游，降低下游压力
* 充分利用缓存：利用缓存可极大提高系统读写速度
* 消息队列：消息队列可以削峰，将拦截大量并发请求，这也是一个异步处理过程，后台业务根据自己的处理能力，从消息队列中主动的拉取请求消息进行业务处理

# 前端方案
* 页面静态化：将活动页面上的所有可以静态的元素全部静态化，并尽量减少动态元素
* 将秒杀活动的静态页面提前刷新到CDN节点
* 禁止重复提交：用户提交之后按钮置灰，禁止重复提交
* 使用验证码，防止机器人、爬虫以及分散用户请求
* 用户限流：在某一时间段内只允许用户提交一次请求，比如可以采取IP限流
# 站点层面的请求拦截
同一个uid，限制访问频度，做页面缓存，x秒内到达站点层的请求，均返回同一页面
同一个item的查询，例如车次，做页面缓存，x秒内到达站点层的请求，均返回同一页面
# 后端方案
* 采用消息队列缓存请求
* 利用缓存应对读写请求
* 加乐观锁防止超卖
* 业务逻辑的异步
    * 下单业务与 支付业务的分离
* 业务规则上的一些优化
    * 做一个粗粒度的“库存”“无库存”缓存即可
# 使用JMeter 压测工具